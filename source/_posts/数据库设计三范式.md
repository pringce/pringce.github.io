---
title: 数据库设计三范式
date: 2020-04-18 16:31:39
tags:
- MySQL
- 个人博客
categories:
- MySQL
mathjax: true
---

### 什么是设计范式

设计表的依据，按照设计三范式设计的表不会出现数据冗余

### 设计三范式

**第一范式**：任何一张表都应该有主键，并且每一个字段原子性不可再分（比如邮箱电话放在联系方式字段里，不符合原子性不可再分，因为可分为邮箱和电话两个字段），如下

| 学生编号 | 学生姓名 |                    联系方式                    |
| :------: | :------: | :--------------------------------------------: |
|   101    |   张三   |            zs@gmail.com,1359999999             |
|   102    |   李四   | [ls@gmail.com](mailto:ls@gmail.com),1369999999 |
|   101    |   王五   |             ww@163.net,1348888888              |

上述表存在如下问题：

- 最后一条记录和第一条记录重复（不唯一，没有主键）
- 联系方式子弹可以再分，不符合原子性不可再分规则

如何解决上述第一范式问题？如下表

| 学生编号(PK) | 学生姓名 |    email     |  联系电话  |
| :----------: | :------: | :----------: | :--------: |
|     101      |   张三   | zs@gmail.com | 1359999999 |
|     102      |   李四   | ls@gmail.com | 1369999999 |
|     103      |   王五   |  ww@163.net  | 134888888  |

上表中学生编号为主键，且各字段符合原子性



**第二范式**：**建立在第一范式基础上**，所有非主键字段完全依赖主键，不能产生部分依赖（主要针对联合主键而言）。**如果单一主键，那么肯定是满足第二范式的**

| 学生编号（PK） | 教师编号（PK） | 学生姓名 | 教师姓名 |
| :------------: | :------------: | :------: | :------: |
|      101       |      001       |   张三   |  王老师  |
|      102       |      002       |   李四   |  赵老师  |
|      103       |      001       |   王五   |  王老师  |
|      101       |      002       |   张三   |  赵老师  |

以上虽然确定了主键（联合主键），但此表出现大量的冗余，主要涉及到冗余字段为“学生姓名”和“教师姓名”，出现冗余的原因在于：学生姓名部分依赖了主键的一个字段学生编号，而没有依赖于教师编号，而教师姓名部分依赖了主键的一个字段教师编号，这就是第二范式的部分依赖。

**下面我们思考一下什么时候要建立联合主键**？存在**多对多**的情况，即一个主键无法完成表中数据唯一性。比如一个订单表，一个订单可能会对应多种商品（那么可能就要存在多行代表同一个订单，一行代表订单中的一种），同样一种商品也可能对应多个订单，这里就不能用单一主键了，必须用联合主键（订单编号+商品编号）。如下表所示：

| 订单编号(pk) | 商品编号(pk) | 商品名称 | 数量 | 价格 | 客户 | 联系方式 |
| :----------: | :----------: | :------: | :--: | :--: | :--: | :------: |
|     001      |      1       |  挖掘机  |  1   | 1200 | 张三 |   123    |
|     001      |      2       |  冲击钻  |  8   |  20  | 张三 |   123    |
|     002      |      3       |   铲车   |  2   | 300  | 李四 |   456    |

那么如何解决上述**多对多问题（解决了多对多，也就解决了第二范式）**呢？

有个口诀：**多对多，三张表，关系表两外键**！如下所示：

第一张表：订单信息表

| 订单编号（pk） | 客户 | 联系方式 |
| :------------: | :--: | :------: |
|      001       | 张三 |   123    |
|      002       | 李四 |   456    |

第二张表：商品信息表

| 商品编号（pk） | 商品名称 | 商品价格 |
| :------------: | :------: | :------: |
|       1        |  挖掘机  |   1200   |
|       2        |  冲击钻  |    20    |
|       3        |   铲车   |   300    |

第三张表：订单信息表和商品信息表的关系表

| ID（pk） | 订单编号（fk） | 商品编号（fk） | 数量 |
| :------: | :------------: | :------------: | :--: |
|    1     |      001       |       1        |  1   |
|    2     |      001       |       2        |  8   |
|    3     |      002       |       3        |  2   |

这样设计，在很大程度上减小了数据库的冗余。如果要获取订单的商品信息，使用商品编号到商品信息表中查询即可。



**第三范式**：**建立在第二范式基础上**，所有非主键字段直接依赖主键字段，不能产生传递依赖

| 学生编号（pk） | 学生姓名 | 班级编号 | 班级名称 |
| :------------: | :------: | :------: | :------: |
|      101       |   张三   |    01    |   一班   |
|      102       |   李四   |    02    |   二班   |
|      103       |   王五   |    03    |   三班   |
|      104       |   赵六   |    03    |   三班   |

从上表可以看出，班级名称字段存在冗余，因为班级名称字段没有直接依赖于主键，班级名称字段依赖于班级编号，班级编号依赖于学生编号，那么这就是**传递依赖**。

**什么时候会出现传递依赖问题呢**？存在**一对多问题**，比如上面的表，一个学生对应一个班级，一个班级对应多个学生，这就是典型的一对多问题。

那么如何解决上述**一对多问题（解决了一对多，也就解决了第三范式）**呢？

有个口诀：**一对多，两张表，多的表加外键（**即一存储在一张表中，多存储在一张表中，在多的那张表中添加外键指向一的一方的主键，班级为一，学生为多，一个班级对应多个学生，在学生信息表加外键**）**！如下所示：

第一张表：学生信息表

| 学生信息表（pk） | 学生姓名 | 班级编号（fk） |
| :--------------: | :------: | :------------: |
|       101        |   张三   |       01       |
|       102        |   李四   |       02       |
|       103        |   王五   |       03       |
|       104        |   赵六   |       03       |

第二张表：班级信息表

| 班级编号（pk） | 班级名称 |
| :------------: | :------: |
|       01       |   一班   |
|       02       |   二班   |
|       03       |   三班   |



**注意：数据库设计尽量遵循三范式，但是还是根据实际情况进行取舍，有时可能会拿冗余换速度，最终用目的要满足客户需求。**



下面说下**一对一的设计方案**，有两种：

- 主键共享
- 外键唯一



一个系统设计完成后，用户注册会生成注册信息，包括用户名、密码，还有一些详细信息（比如联系方式、性别、年龄等）。这是一种典型的一对一问题，那么怎么设计相应的表呢？下面针对上面两种方案分别介绍

**第一种：主键共享**

- 第一张表：t_user_login

| id(pk) | 用户名 | 密码 |
| :----: | :----: | :--: |
|   1    |  张三  | 123  |
|   2    |  李四  | 456  |

- 第二张表：t_user_detail

| id（pk+fk） | 联系方式 | 性别 | 年龄 |
| :---------: | :------: | :--: | :--: |
|      1      | 1326616  |  男  |  18  |
|      2      | 1346511  |  女  |  21  |

这里在表t_user_detal中，id既是主键，也是引用t_user_login中id字段的外键，这就是所谓的**主键共享**



**第二种：外键唯一**

- 第一张表：t_user_login

| id(pk) | 用户名 | 密码 |
| :----: | :----: | :--: |
|   1    |  张三  | 123  |
|   2    |  李四  | 456  |

- 第二张表：t_user_detail

| id（pk） | 联系方式 | 性别 | 年龄 | userid（fk+unique） |
| :------: | :------: | :--: | :--: | :-----------------: |
|    1     | 1326616  |  男  |  18  |          1          |
|    2     | 1346511  |  女  |  21  |          2          |

这里在表t_user_detal中，id是主键，userid引用t_user_login中id字段的唯一外键，这就是所谓的**外键唯一**

