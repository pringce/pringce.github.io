---
title: MySQL之查询、去重、限制条数、排序
date: 2020-03-24 10:07:44
tags:
- MySQL
- 个人博客
categories:
- MySQL
mathjax: true
---

对于使用`MySQL`的我们来说，平时使用频率最高的还是查询功能，就是按照我们给定的要求将数据给查出来。

# 查询



## 查询单个列

查看某个表中的某一列的数据的通用格式是这样：

```mysql
SELECT 列名 FROM 表名;
```

也就是说把需要查询的列名放到单词`SELECT`后边就好了，比如查看`student_info`表中的`number`列的数据可以这么写：

```mysql
mysql> SELECT number FROM student_info;
+----------+
| number   |
+----------+
| 20180104 |
| 20180102 |
| 20180101 |
| 20180103 |
| 20180105 |
| 20180106 |
+----------+
6 rows in set
```

可以看到查询结构中就把所有记录的`number`列都展示了出来，我们有时候也把这个结果称之为`结果集`。



## 列的别名

我们也可以为结果集中的列重新定义一个`别名`，命令格式如下：

```mysql
SELECT 列名 [AS] 列的别名 FROM 表名;
```

我们看到`AS`被加了个中括号，意味着可有可无，没有`AS`的话，列名和列的别名之间用空白字符隔开就好了。比如我们想给`number`列起个别名，可以使用下边这两种方式之一：

- 方式一

```mysql
SELECT number AS 学号 FROM student_info;
```

- 方式二

```mysql
SELECT number 学号 FROM student_info;
```

执行结果如下：

```mysql
mysql> SELECT number AS 学号 FROM student_info;
+----------+
| 学号     |
+----------+
| 20180104 |
| 20180102 |
| 20180101 |
| 20180103 |
| 20180105 |
| 20180106 |
+----------+
6 rows in set
```

看到黑框框里的结果集中显示的列名就不再是`number`，而是我们刚刚定义的别名`学号`了。不过需要注意的是：**别名只是在本次查询的到的结果集中展示，而不会改变真实表中的列名**。下一次查询中你对`number`列取其他的别名也可以。



## 查询多个列

如果想查询多个列的数据，可以在`SELECT`后边写多个列名，用逗号`,`分隔开就好：

```mysql
mysql> SELECT 列名1, 列名2, ... 列名n FROM 表名;
```

我们把`SELECT`语句后边跟随的多个列统称为`查询列表`，**需要注意的是，查询列表中的列名可以按任意顺序摆放，结果集将按照我们摆放的列名顺序显示**

注意，查询多个列也能分别加别名

```mysql
mysql> SELECT 列名1 as a, 列名2 as b, ... 列名n as n FROM 表名;
```



## 查询所有列

如果需要把记录中的所有列都查出来，`MySQL`也提供一个省事儿的办法，我们之前也介绍过，就是直接用星号`*`来表示要查询的东西，就像这样：

```mysql
SELECT * FROM 表名;
```

**注意**：除非你确实需要表中的每个列，否则一般最好别使用星号`*`来查询所有列，虽然星号`*`看起来很方便，不用明确列出所需的列，但是查询不需要的列通常会降低性能。



# 查询结果去重

## 去除单列的重复结果

有的时候我们查询某个列的数据时会有一些重复的结果，比如我们查询一下`student_info`表的学院信息：

```mysql
mysql> SELECT department FROM student_info;
+------------+
| department |
+------------+
| 计算机学院 |
| 计算机学院 |
| 计算机学院 |
| 计算机学院 |
| 航天学院   |
| 航天学院   |
+------------+
6 rows in set
```

因为表里有6条记录，所以给我们返回了6条结果。但是其实好多都是重复的结果，如果我们想去除重复结果的话，可以将`DISTINCT`放在被查询的列前边，就是这样：

```mysql
SELECT DISTINCT 列名 FROM 表名;
```

结果如下：

```mysql
mysql> SELECT DISTINCT department FROM student_info;
+------------+
| department |
+------------+
| 计算机学院 |
| 航天学院   |
+------------+
2 rows in set
```



## 去除多列的重复结果

对于查询多列的情况，**两条结果重复的意思是：两条结果的每一个列中的值都相同**。比如查询学院和专业信息：

如果我们想对多列查询的结果去重的话，可以直接把`DISTINCT`放在被查询的列的最前边：

```mysql
SELECT DISTINCT 列名1, 列名2, ... 列名n  FROM 表名;
```

结果如下：

```mysql
mysql> SELECT DISTINCT department, major FROM student_info;
+------------+------------------+
| department | major            |
+------------+------------------+
| 计算机学院 | 计算机科学与工程 |
| 计算机学院 | 软件工程         |
| 航天学院   | 飞行器设计       |
| 航天学院   | 电子信息         |
+------------+------------------+
4 rows in set
```

**注意：distinct只能出现在所有字段的最前方**，即前面不能出现的别的字段，要不然查询出来的数目不对应（因为有的去重了，有的没去重）



# 限制查询结果条数

注意：**LIMIT是MySQL特有的，其它数据库不通用（Oracle有一个相同的机制，叫做rownum）**

有时候查询结果的条数会很多，都显示出来可能会撑爆屏幕～ 所以`MySQL`给我们提供了一种限制结果集中的记录条数的方式，就是在查询语句的末尾使用这样的语法：

```mysql
LIMIT 开始行, 限制条数;
```

`开始行`指的是我们想从第几行数据开始查询，`限制条数`是结果集中最多包含多少条记录。从0开始，0代表第一行

比如我们查询一下`student_info`表，从第1条记录开始，最多查询2条记录可以这么写：

```mysql
mysql> SELECT number, name, id_number, major FROM student_info LIMIT 0, 2;
+----------+-----------+--------------------+--------------------------+
| number   | name      | id_number          | major                    |
+----------+-----------+--------------------+--------------------------+
| 20180101 | 杜子腾    | 158177199901044792 | 计算机科学与工程         |
| 20180102 | 杜琦燕    | 151008199801178529 | 计算机科学与工程         |
+----------+-----------+--------------------+--------------------------+
2 rows in set (0.00 sec)
```

**注意**：如果指定的`开始行`大于表中的最大行数，那查询结果就什么都没有：开始行默认从第0行开始（计算机中的第0行是我们平时说的第一行）。如果查询的结果条数不超过`限制条数`，那就可以全部显式出来



`LIMIT`后边也可以只有一个参数，那这个参数就代表着`限制行数`。也就是说我们可以不指定`开始行`，**默认的开始行就是第0行**。



**重点：通用的标准分页SQL？**

每页显示三条记录：

第一页：0,3

第二页：3,3

第三页：6,3

第五页：9,3

........

通用公式如下：

每页显示pageSize记录：

第pageNo页：**（pageNo-1）*pageSize，pageSize**

pageSize是每页显示多少条记录，pageNo是显示第几页



# **对查询结果排序**

我们之前查询`number`列的时候得到的记录并不是有序的，这是为什么呢？`MySQL`其实默认会按照这些数据底层存储的顺序来给我们返回数据，但是这些数据可能会经过更新或者删除，如果我们不明确指定按照什么顺序来排序返回结果的话，那我们可以认为该结果中记录的顺序是不确定的。换句话说如**果我们想让返回结果中的记录按照某种特定的规则排序，那我们必须显式的指定排序规则**。



## 按照单个列的值排序

我们可以用下边的语法来指定返回结果的记录按照某一列的值进行排序：

```mysql
ORDER BY 列名 ASC|DESC
```

`ASC`和`DESC`指的是排序方向。`ASC`是指按照指定列的值进行由小到大进行排序，也叫做`升序`，`DESC`是指按照指定列的值进行由大到小进行排序，也叫做`降序`，中间的`|`表示这两种方式只能选一个。这回我们用`student_score`表测试一下

```mysql
mysql> SELECT * FROM student_score ORDER BY score ASC;
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180104 | 论萨达姆的战争准备          |    46 |
| 20180104 | 母猪的产后护理              |    55 |
| 20180103 | 母猪的产后护理              |    59 |
| 20180103 | 论萨达姆的战争准备          |    61 |
| 20180101 | 母猪的产后护理              |    78 |
| 20180101 | 论萨达姆的战争准备          |    88 |
| 20180102 | 论萨达姆的战争准备          |    98 |
| 20180102 | 母猪的产后护理              |   100 |
+----------+-----------------------------+-------+
8 rows in set (0.01 sec)
```

可以看到输出的记录就是按照成绩由小到大进行排序的。如果省略了 ORDER BY 语句中的排序方向，则**默认按照从小到大的顺序进行排序**，也就是说`ORDER BY 列名`和`ORDER BY 列名 ASC`的语义是一样的



## **按照多个列的值排序**

我们也可以同时指定多个排序的列，多个排序列之间用逗号`,`隔开就好了，就是这样：

```mysql
ORDER BY 列1 ASC|DESC, 列2 ASC|DESC ...
```

它的意思是根据顺序依次进行排序，比如先按列1排序，排完之后再按照列2排序，以此类推。

比如我们想让对`student_score`的查询结果先按照`subjuect`排序，再按照`score`值从大到小的顺序进行排列，可以这么写：

```mysql
mysql> SELECT * FROM student_score ORDER BY subject, score DESC;
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180102 | 母猪的产后护理              |   100 |
| 20180101 | 母猪的产后护理              |    78 |
| 20180103 | 母猪的产后护理              |    59 |
| 20180104 | 母猪的产后护理              |    55 |
| 20180102 | 论萨达姆的战争准备          |    98 |
| 20180101 | 论萨达姆的战争准备          |    88 |
| 20180103 | 论萨达姆的战争准备          |    61 |
| 20180104 | 论萨达姆的战争准备          |    46 |
+----------+-----------------------------+-------+
8 rows in set (0.00 sec)
```

**注意：MySQL中用order by排序的字段不一定要在select语句中，而且order by后面还可以跟聚集函数**

我们还可以让`ORDER BY`语句和`LIMIT`语句结合使用，不过 ORDER BY 语句必须放在 LIMIT 语句前边

```mysql
mysql> SELECT * FROM student_score ORDER BY score LIMIT 1;
+----------+-----------------------------+-------+
| number   | subject                     | score |
+----------+-----------------------------+-------+
| 20180104 | 论萨达姆的战争准备          |    46 |
+----------+-----------------------------+-------+
1 row in set (0.00 sec)
```

这样就能找出成绩最低的那条记录了

